{
  "title": "RAG Aerospace Alerts",
  "panels": [],
  "annotations": {"list": []},
  "templating": {"list": []},
  "alertRules": [
    {
      "title": "Vector Search p95 > 1s",
      "condition": "C",
      "data": [
        {
          "refId": "A",
          "expr": "histogram_quantile(0.95, sum(rate(vector_search_duration_seconds_bucket[5m])) by (le))"
        },
        {
          "refId": "B",
          "expr": "1"
        },
        {
          "refId": "C",
          "condition": "A > B"
        }
      ]
    },
    {
      "title": "HTTP 5xx > 5%",
      "condition": "C",
      "data": [
        {
          "refId": "A",
          "expr": "sum(rate(starlette_requests_total{status=~\"5..\"}[5m])) / sum(rate(starlette_requests_total[5m]))"
        },
        {
          "refId": "B",
          "expr": "0.05"
        },
        {
          "refId": "C",
          "condition": "A > B"
        }
      ]
    },
    {
      "title": "Readiness non-200",
      "condition": "A > 0",
      "data": [
        {
          "refId": "A",
          "expr": "sum(rate(starlette_requests_total{path=\"/ready\",status!=\"200\"}[5m]))"
        }
      ]
    },
    {
      "title": "HTTP p95 > 800ms",
      "condition": "C",
      "data": [
        {"refId": "A", "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))"},
        {"refId": "B", "expr": "0.8"},
        {"refId": "C", "condition": "A > B"}
      ]
    },
    {
      "title": "Rate limit 429 > 10%",
      "condition": "C",
      "data": [
        {"refId": "A", "expr": "sum(rate(starlette_requests_total{status=\"429\"}[5m])) / sum(rate(starlette_requests_total[5m]))"},
        {"refId": "B", "expr": "0.10"},
        {"refId": "C", "condition": "A > B"}
      ]
    },
    {
      "title": "/ask LLM p95 > 2s",
      "condition": "C",
      "data": [
        {"refId": "A", "expr": "histogram_quantile(0.95, sum(rate(ask_llm_duration_seconds_bucket[5m])) by (le))"},
        {"refId": "B", "expr": "2"},
        {"refId": "C", "condition": "A > B"}
      ]
    },
    {
      "title": "Offline Eval Recall < 0.7",
      "condition": "C",
      "data": [
        {"refId": "A", "expr": "offline_eval_recall_last"},
        {"refId": "B", "expr": "0.7"},
        {"refId": "C", "condition": "A < B"}
      ]
    },
    {
      "title": "Offline Eval AnswerContains < 0.6",
      "condition": "C",
      "data": [
        {"refId": "A", "expr": "offline_eval_answer_contains_last"},
        {"refId": "B", "expr": "0.6"},
        {"refId": "C", "condition": "A < B"}
      ]
    }
  ]
}
