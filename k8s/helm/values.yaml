image:
  repository: ghcr.io/YOUR_USER/rag-aerospace
  tag: latest
  pullPolicy: IfNotPresent

redis:
  enabled: false

apiSecrets:
  create: false
  literals: {}

env:
  - name: OPENAI_API_KEY
    valueFrom:
      secretKeyRef: { name: openai-secret, key: api_key }
  - name: EMBED_MODEL
    value: text-embedding-3-large
  - name: MILVUS_HOST
    value: milvus-standalone.milvus.svc.cluster.local
  - name: MILVUS_PORT
    value: "19530"
  - name: API_KEY
    valueFrom:
      secretKeyRef: { name: api-secrets, key: api_key }
  - name: JWT_SECRET
    valueFrom:
      secretKeyRef: { name: api-secrets, key: jwt_secret }
  - name: JWT_ISSUER
    valueFrom:
      secretKeyRef: { name: api-secrets, key: jwt_issuer }
  - name: JWT_AUDIENCE
    valueFrom:
      secretKeyRef: { name: api-secrets, key: jwt_audience }
  - name: REDIS_URL
    valueFrom:
      secretKeyRef: { name: api-secrets, key: redis_url }
  - name: RETRIEVER_BACKEND
    value: faiss
  - name: METRICS_PUBLIC
    value: "false"
  - name: RATE_LIMIT_PER_MIN
    value: "120"

service:
  type: ClusterIP
  port: 80
  targetPort: 8000

hpa:
  enabled: false
  minReplicas: 2
  maxReplicas: 8
  targetCPUUtilizationPercentage: 70

ingress:
  enabled: false
  className: nginx
  annotations: {}
  hosts:
    - host: example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: rag-aerospace-tls
      hosts:
        - example.com

pdb:
  enabled: false
  minAvailable: 1

# KEDA ScaledObject (optional)
keda:
  enabled: false
  pollingInterval: 30
  cooldownPeriod: 120
  minReplicaCount: 2
  maxReplicaCount: 10
  triggers:
    - type: cpu
      metadata:
        type: Utilization
        value: "70"
    - type: prometheus
      metadata:
        serverAddress: http://prometheus-server.monitoring.svc.cluster.local
        metricName: http_qps
        query: sum(rate(starlette_requests_total[1m]))
        threshold: "5"
